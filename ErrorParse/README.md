## 符号表相关

**参数名**：属于函数的下层，但在函数编译完成后，它与函数处于同一层，但是名字必须去掉。

**栈式符号表**：当前正在查表的元素一定位于栈顶。

push和drop时应同时对分程序索引表进行修改。

**删除**：有可能出现删除全局的情况：这时候程序已经结束，可以清空整个符号表。

**全局符号表**：使用map，用标识符的名称作为索引。

**无符号整数**：不能包含前导零。(未修改)

### 函数定义

> 在定义时将函数的参数个数保存在符号表中
>
> 函数定义结束后，需要将函数内的局部变量清除
>
> 为符号表新增一个“参数域”，用来保存函数的参数



## 错误处理相关

#### 重大修改：

输出流由词法分析器共享变为全局输出文件流。

#### 一些小错误（TRICKS）

在赋值语句和函数调用语句的判断位置，拆散了语法结构。

**跳读的写法** -- 还没想出来

#### 条件判断中出现不合法的类型

1. **整型表达式**之间才能进行运算

   可以通过对偶问题来解决

错误处理：预读（预判断处理）：如果非法，那么需要退回。

#### 词法分析错误处理

词法分析器中包含的错误类型不多，因此，将错误处理放到词法分析内部



#### 语法分析错误处理

##### 名字重定义：

在标识符定义处查符号表。

##### 未定义的名字：

- ​	放在符号表中的一个全局函数，每次使用标识符的地方都要检查

- ​	使用标识符的地方：因子、赋值语句、for、函数调用、读语句

- 函数调用中：如果函数名称未定义，不能跳过值参数表的解析，而应该跳过与原函数的比较。


##### 函数参数问题

- 函数参数个数不匹配：值参数表解析 + 查符号表
- 函数参数类型不匹配：值参数表解析 + 查符号表
- 在值参数表解析中，将右小括号吃掉。

##### **数组的参数只能是整型表达式**

变量定义（变量定义里有可能不符合语法）、因子、赋值语句

##### **改变常量的值**：

赋值语句: 常量出现在赋值语句右边. 如果右边是常量，则直接跳过赋值语句.

**常量定义中=后面只能是整型或字符型常量**

- int型常量
- char 型常量

##### **应为分号**

- 语句结束
- 常量定义
- 变量定义
- for语句中间

##### **应为右小括号**

- **函数值参数表**
  
  - 逗号：正常，继续循环
  - 小括号：正常，退出
  - 分号：缺少小括号，退出
  - 其他：缺少小括号，并且退出
  
- 表达式因子

- 函数参数表

- main函数的参数表

- 条件：条件语句和循环语句

- for语句

- return

- printf ：：：： 为什么没处理？？？ 2019/10/31

- scanf

- 关于空语句

  这种是否合法

  ```
  if(a>b){} // 需要有分号吗
  ```

  ![1572231669932](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1572231669932.png)

##### **应为右中括号]**

- 出现数组的地方
  - 变量定义处
  - 因子
  - 赋值语句

##### **return相关** --- 很难设计

- 从return分析语句开始，构造继承属性，经过【语句，语句列，复合语句】才能到达【函数层】，试着发现一条捷径？？---可以，使用引用，通过改变引用避免改变函数的返回值
- 允许有多条return语句，只要有一个类型不符合，就会报错
- 有返回值函数定义中没有出现类型匹配的return

**条件判断**

要求表达式必须是整型

- 单表达式
- 双表达式

#### 符号表错误处理

名字重定义：放在查表中。



### 整型表达式--done

> 情况一：char型变量，常量，数组元素，函数调用
>
> 情况二：字符字面量

- 函数返回值return语句
- 数组元素下标
- 条件判断

> 注意在整型表达式分析的过程中，采用了如下结构，是为了保证一旦整型表达式被建立，不管其后加入char型与否，都不再改变其类型。

![1572518715460](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1572518715460.png)



### 编译遇到的错误

> 在词法分析头函数中定义了extern变量，但是在源文件中找不到。
>
> 这个问题很难搞，最后只能把输出改为追加式。（幸好没有多线程）



## 测试

### 单元测试

- b类问题：名字重定义
- c类问题：名字未定义
- d类问题：函数参数个数不对
- 



## 论坛

- 大家的作业编译器中不需要判断每个路径是否有return语句，测试程序中每个分支都有return语句的。

- 不需要进行永假式/永真式检测。

- 不符合词法

  - 1. 出现词法规则里不允许出现的符号（在词法分析的过程中找出非法符号）
    
    2. 在定义字符的时候，同一行中没有找到配对的右单引号
    
    3. 在定义字符串的时候，同一行中没有找到配对的右双引号

  其他只要在词法分析中能正确识别的，都在语法分析中进行进一步判断是否符合相应的语法规则  

- 标识符重定义：按照第一次的标准来定义



## 难以处理

- ### 词法分析

  ```
  const int co#nst1 = 1, cons*t2 = -100;
  const char 0const13 = 'a';
  // 中间要是有非法字符怎么处理
  // 要是数字开头的标识符怎么识别
  ```


- ### 函数调用值参数表

  一旦参数表为空并且缺少右括号

- ### 函数调用因子：

  如果函数未定义那么因子的类型如何定义？

- ### 不能有前导零这个问题始终没有考虑

## 如果有一天

> 如果有一天需要尽可能多的输出错误：

- 函数值参数表的解析

  函数参数个数不匹配的时候直接跳过了类型检查